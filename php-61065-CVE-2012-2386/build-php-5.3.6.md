# build php
CC=wllvm ./configure --enable-debug --disable-all --disable-cgi --enable-phar
make
extract-bc sapi/cli/php

# run php in klee
# fabs is removed from bitcode as a workaround of lack of klee support
# env USE_ZEND_ALLOC=0 is important since ZEND_ALLOC requires mmap
opt -load ~/transforms/build/RmFabs/libLLVMRmFabs.so -rmfabs -o test.bc < php-5.3.6/sapi/cli/php.bc
env USE_ZEND_ALLOC=0 ~/klee/build/bin/klee --libc=uclibc --posix-runtime test.bc poc.php
